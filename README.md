# cuthkv

#### /get
    получение по ключу элемента из хранилища
    /get?key=111
    
#### /lget
    получение по ключу элемента из списка
    /lget?key=111&innerkey=12
    
#### /mget
    получение по ключу элемента из словаря
    /mget?key=111&innerkey=qqq
    
#### /set
    сохранение элемента в хранилище
    структура json'a для передачи Post'ом
```json
{     
  "key": "key_string",
  "value": "string",  
  "ttl": 10 
}
```
```json
{     
  "key": "key_slice",
  "value": ["elem1", "elem2"],  
  "ttl": 11 
}
```
```json
{     
  "key": "key_map",
  "value": {"map_key1":"map_elem1"},  
  "ttl": 12 
}
```
#### /remove
    удаление из хранилища
    /remove?key=111
    
#### /keys
    получение ключей из хранилища, по маске pattern
    /keys?pattern
#### /stat
    простейшая статистика хранилища
```json
{
  "stat":{
      "gcCall":1,
      "hit":2,
      "len":1,
      "missed":1
  }
}
```
# cuthkvclient
что-то наподобии балансера, распределяющего ключи по хранилищам.

методы те же что и у хранилищ, кроме /keys, /stat.

вычисляет хеш ключа, выбирает сервер и перенаправляет запрос на него

#### /keys
получение ключей из хранилищ. запрашивает /keys?pattern=pattern у все известных ему хранилищ

#### /stat
отдает хранимую у себя статистику по известным хранилищам

обновляет статистику через интервал из конфига, опрашивая все известные хранилища

### Развертывание
#### single
на примере cuthkv \
конфиг должен лежать рядом с файлом \
имя конфига - имя_бинарника - cuthkv.toml \
меняем host port в конфиге. \
в консоли ./cuthkv \
по http://host:port/ можно пользоваться
#### multiple
несколько раз как в сингле копируем файл+конфиг, настраиваем, запускаем несколько инстансов хранилищ \
так же настраиваем cuthkvclient + прописываем в конфиге в storedList url'ы инстансов

в консоли ./cuthkvclient \
по http://clienthost:clientport/ можно пользоваться
